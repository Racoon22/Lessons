
<!-- saved from url=(0040)http://dklab.ru/lib/DbSimple/manual.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
    <meta name="verify-reformal" content="9157f95e30001c641c8c4d1a">
    <meta name="google-site-verification" content="pngpm7ZFMdwkMMaE4isvs0tPhjpZa2VnWufdc4hUMlg">
<title>dkLab | Конструктор | DbSimple: лаконичная работа с различными СУБД | Подробности</title><link rel="stylesheet" type="text/css" href="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/style.css" media="screen">
<meta name="verify-v1" content="AdhQ433Py33ev/uxSehHf8AMukUbhFmR7NqPWkgv2Rg=">
<meta name="description" content="Лаборатория dk: AJAX-библиотека JsHttpRequest с поддержкой Prototype JS, другие библиотеки, статьи по web-программированию">
<meta name="keywords" content="AJAX JsHttpRequest XMLHttpRequest PHP модуль prototype DbSimple apache windows denwer denver windows win32 winxp orphus sshbak статьи web-программирование орфус">
<style type="text/css">* {}</style><style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style></head>

<body bgcolor="#DEDFDE" text="black" link="blue" vlink="#0022FF" alink="BB00BB" style="padding:2px; margin:2px; margin-right:16px">

<!--LiveInternet counter--><script type="text/javascript"><!--
new Image().src = "http://counter.yadro.ru/hit?r"+
escape(document.referrer)+((typeof(screen)=="undefined")?"":
";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
";h"+escape(document.title.substring(0,80))+
";"+Math.random();//--></script><!--/LiveInternet-->

<table cellpadding"0"="" cellspacing="0" border="0" width="100%"><tbody><tr valign="top">
<td style="width: 160px; padding:8px 0 0 0; text-align:left">
<div style="padding-bottom:6px; width:160px">
<noindex>Генеральный спонсор: <a href="http://www.jino.ru/">Хостинг «Джино»</a></noindex><br><br>
<script type="text/javascript"><!--
google_ad_client = "pub-7882344363883855";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel ="";
google_color_border = "000000";
google_color_bg = "DEDFDE";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
		

</div>
<div style="padding-bottom:6px"><noindex>
<script language="JavaScript" src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/orphus.js"></script>
<a href="http://orphus.ru/" id="orphus" title="Система Orphus"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/orphus.gif" alt="Система Orphus" width="121" height="21" border="0"></a>


</noindex></div>
<div style="padding-top:6px"><!--LiveInternet logo--><a href="http://www.liveinternet.ru/click" target="_blank"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/logo" alt="" width="31" title="LiveInternet" height="31" border="0"></a><!--/LiveInternet--></div>
</td>

<td style="padding: 0px 2px 0px 0px">
<div style="padding: 0em 1em 0em 2em">
<div style="float:left; margin-top:0.4em">
<a href="http://dklab.ru/" title="Go to the home page">Russian version<br>
<img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/dklab_logo_ru.gif" alt="" border="0" width="108" height="47"></a>
<div style="margin-bottom: 6px"><a id="1" href="http://del.icio.us/post?url=http://dklab.ru/lib/DbSimple/manual.html&title=%D0%9F%D0%BE%D0%B4%D1%80%D0%BE%D0%B1%D0%BD%D0%BE%D1%81%D1%82%D0%B8">Добавить на Del.icio.us</a>
<script>document.getElementById('1').href = 'http://del.icio.us/post?url=http://dklab.ru/lib/DbSimple/manual.html&title='+encodeURIComponent(document.title.replace(/.*\|\s*/, ''))</script></div>
</div>

<div style="float:right; text-align:right; margin-top:0.4em">
<span style="color:#AAAAAA" title="Отсутствует">English version</span>
<div style="margin-bottom: 6px"><a id="2" href="http://digg.com/submit?phase=2&url=http://dklab.ru/lib/DbSimple/manual.html&title=%D0%9F%D0%BE%D0%B4%D1%80%D0%BE%D0%B1%D0%BD%D0%BE%D1%81%D1%82%D0%B8">Добавить на Digg.com</a>
<script>document.getElementById('2').href = 'http://digg.com/submit?phase=2&url=http://dklab.ru/lib/DbSimple/manual.html&title='+encodeURIComponent(document.title.replace(/.*\|\s*/, ''))</script></div>
</div>

<h2 style="text-align: center; margin: 0px 0px 0.4em 0px; padding">&nbsp;<a class="HeadLink" href="http://dklab.ru/">dkLab</a> | <a href="http://dklab.ru/lib">Конструктор</a> | DbSimple: лаконичная работа с различными СУБД | Подробности&nbsp;</h2>

<center>
<noindex>
   <a href="http://dklab.ru/map/"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/gomapico.gif" alt="" border="0" width="17" height="17">Карта сайта</a>
:: <a title="Обсуждение вопросов Web-разработки и не только." href="http://dklab.ru/redir?http://forum.dklab.ru"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/forum.gif" alt="" border="0" width="16" height="16">Форум «Лаборатории»</a> 
:: <a title="Apache + PHP + MySQL + Perl и т. д. одним оптимизированным дистрибутивом." href="http://www.denwer.ru/"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/denwer.gif" alt="" border="0" width="16" height="16">Проект «Денвер»</a><br>
   <a title="Технология сообщения об орфографических ошибках на базе энтузиазма пользователя." href="http://orphus.ru/"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/orphus(1).gif" alt="" border="0" width="17" height="17">Проект «Orphus»</a>
:: <a title="Авторские статьи на тему Web-программирования." href="http://dklab.ru/chicken/nablas/"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/nabla12.gif" alt="" border="0" width="14" height="15">Куроводство: наблы</a>
:: <a title="Готовые решения и библиотеки." href="http://dklab.ru/lib/"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/lib.gif" alt="" border="0" width="25" height="15">Конструктор</a>
</noindex>


</center>
<br><br>
<p>
<style>
h4 { margin-bottom: 0.3em }
</style>



<table width="100%">
<tbody><tr valign="top">
<td style="padding-right:1em">
<div style="float:right; padding-top: 2px">
<i>2006-03-03</i>
</div>

<div>
<a href="http://dklab.ru/lib/DbSimple/demo.zip"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/download.gif" alt="" border="0" width="16" height="16"></a>
<a href="http://dklab.ru/lib/DbSimple/demo.zip" style="font-size: 19px; font-weight: bold; text-decoration:none">Скачать библиотеку и примеры</a>
</div>
                    <a style="font-size: 19px; font-weight: bold; text-decoration:none" href="http://dklab.ru/redir?http://forum.dklab.ru/comments/lib/DbsimpleV2XLaconicWorkWithVariousSubd.html"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/forum_favicon.ico" alt="" width="16" style="margin-right:4px" height="16" border="0">Обсудить на форуме</a><br>
        
<hr>
Принять участие в разработке библиотеки/утилиты можно на <a href="http://github.com/DmitryKoterov/dbsimple/tree/master" target="_blank">GitHub</a>.


<hr>
<p>

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Внимание! Текущая версия библиотеки DbSimple — 2.x. Отличия от версии 1.x: еще более 
упрощенный интерфейс (совместим с DbSimple 1.x не полностью!); поддержка условных 
макроподстановок (<nobr><tt>{}</tt></nobr>-блоков) в SQL-запросах; кэширование запросов.
</div></td>
</tr>
</tbody></table></p>

<p>В PHP встроено множество функций для работы с самыми разнообразными СУБД. Однако
у четвертой версии языка есть большой недостаток: все эти функции различаются между
собой как по числу принимаемых параметров, так и по идеологии работы с базой данных. 
Например, функция <nobr><tt>mysql_query()</tt></nobr> (для MySQL) принимает идентификатор соединения с БД во втором
параметре, а аналогичный вызов <nobr><tt>ibase_query()</tt></nobr> (для InterBase/FireBird) — в первом. 
При использовании «прямых» обращений к таким функциям в большинстве случаев можно
даже и забыть о том, чтобы перенести сайт на другую СУБД, пусть даже диалекты SQL
у старой и новой базы почти совпадают и удовлетворяют стандарту <a href="http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt">SQL'92</a>.

</p><p>Для «выравнивания» различий и сведения всех обращений к различным СУБД в единый
интерфейс существует довольно большое число библиотек. Самые популярные из них, пожалуй,
— библиотека <a href="http://pear.php.net/package/DB">PEAR DB</a> и 
<a href="http://adodb.sourceforge.net/">ADOdb</a>; PHP версии 5 также поддерживает 
<a href="http://php.net/pdo">PDO</a>. Все библиотеки умеют работать с более чем десятком 
различных СУБД, при этом интерфейс выполнения запросов во всех случаях остается одним и тем же.



</p><h2><a name="cont0"></a><span style="font-size: 18pt">Что нужно скрипту от СУБД?</span></h2>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Вы можете спросить: зачем еще одна библиотека, раз их и так написано множество? 
Штука в том, что скриптам нужны далеко не все операции, предоставляемые PHP 
(или, например, библиотеками PEAR и ADOdb) для работы с любой СУБД. С другой стороны,
по-настоящему необходимые операции (см. ниже) должны быть реализованы так, чтобы ими 
было удобно пользоваться, а этого как раз имеющиеся библиотеки лишены.
</i></p></td>
</tr>
</tbody></table></p>

<p>Ниже я перечислю тот минимум, который, по моему мнению, необходим скриптам для 
«комфортной» работы с произвольной СУБД. (Звездочками отмечены возможности, которые 
либо отсутствуют в PEAR DB, ADOdb и PDO, либо же реализованы неудовлетворительно.)

</p><ul>

<li><b>Интерфейс должен быть максимально простым, ненавязчивым и неизбыточным (*)</b>. Это очень 
важное требование, потому что работа с SQL порой занимает львиную долю кода PHP-скриптов, и
от того, насколько она будет «прозрачной», зависит энтузиазм программиста.

</li><li><b>Поддержка <a href="http://dklab.ru/lib/Database_Placeholder">placeholder-ов</a></b>: для вставки данных в 
строку SQL-запроса используются специальные маркеры, например, "?", а сами данные передаются
позже: <tt>query('SELECT * FROM tbl WHERE id=?', $id)</tt>.

</li><li><b>Абстрагирование от параметров подключения к СУБД</b>: подключение к СУБД
использует единообразную строку коннекта (DSN — Data Source Name): 
<nobr><tt>connect("mysql://login:password@database?options")</tt></nobr>.

</li><li><b>Логирование запросов к СУБД (*)</b>:
<ul>
<li>какие запросы с какими параметрами (значениями placeholder-ов) выполнялись в ходе всей работы скрипта;
</li><li>какие результаты вернули запросы (для небольших однострочных и скалярных выборок — явно, для 
многомерных — число строк результата);
</li><li>какая строка программы вызвала тот или иной SQL-запрос;
</li><li>сколько времени заняло выполнение запроса.
</li></ul>

</li><li><b>Механизм обработки ошибок в SQL-запросах (*)</b>: хотя бы с применением callback-вызова обработчика ошибок,
которому передается исчерпывающая информация о контексте запроса.

</li><li><b>Функции простейшей выборки из базы</b> с применением placeholder-ов: 
<ul>
<li><nobr><tt>mixed select(string $query [,$arg1...])</tt></nobr>: выборка двумерного массива (список строк);
</li><li><nobr><tt>hash selectRow(string $query [,$arg1...])</tt></nobr>: выборка однострочного результата запроса (одна строка);
</li><li><nobr><tt>array selectCol(string $query [,$arg1...])</tt></nobr>: выборка одноколоночного результата запроса (один столбец);
</li><li><nobr><tt>scalar selectCell(string $query [,$arg1...])</tt></nobr>: выборка скалярного результата запроса (одна ячейка)
</li><li><nobr><tt>mixed selectPage(int &amp;$total, string $query [,$arg1...])</tt></nobr>: выборка ограниченного двумерного массива с занесением общего числа записей в переменную;
</li><li><nobr><tt>mixed query(string $query [,$arg1...])</tt></nobr>: вызов не-SELECT запроса; для автоинкрементных полей (MySQL) возвращает ID вставленной записи.
</li></ul>

</li><li><b>Простейшее форматирования двумерной выборки (*)</b>:
<ul>
<li>в виде ассоциативного массива (возможно, многомерного) с ключами, взятыми из определенного столбца выборки;
</li><li>в виде дерева, когда идентификатор элемента берется из одного столбца, а идентификатор его родителя — из другого.
</li></ul>

</li><li><b>Списковые и ассоциативные placholder-ы (*)</b>: чтобы можно было писать что-то типа 
<nobr><tt>query('SELECT * FROM tbl WHERE id IN(?a)', array(1,2,3))</tt></nobr>, а также короткие UPDATE-выражения,
в которых все данные берутся из ассоциативного массива.

</li><li><b>Поддержка транзакций</b>: даже если СУБД не поддерживает транзакции, интерфейс должен быть единым.

</li><li><b>Поддержка объектных BLOB-полей (*)</b>: если в какой-то BLOB-ячейке хранится запись размером, предположим, 
500М, должна быть возможность извлечь ее оттуда по кускам, считывая участок за участком в цикле.

</li></ul>


<h2><a name="cont1"></a><span style="font-size: 18pt">Недостатки PEAR DB и ADOdb</span></h2>

<p>Обратите внимание, сколько в приведенном списке пунктов, поддержка которых в PEAR DB и ADOdb,
как мне кажется, находится на неудовлетворительном уровне. В то же время, эти две библиотеки поддерживают
еще множество возможностей, которые в данный список не вошли в виду их малой практической целесообразности
и большой избыточности:

</p><ul>
<li>громоздкая сортировка ошибок СУБД по их типам;
</li><li>различные форматы результата выборки, отличные от ассоциативных массивов (например, выборка в виде объектов PHP);
</li><li>вынесение в интерфейс операций prepare и execute (это излишество, ибо функции выборки, заметив, что запросы 
поступают однотипные, и сами могут решить, что им стоит сделать 1 раз prepare, а потом — 100 раз execute);
</li><li>разделение в интерфейсе операций «выполнить запрос» и «получить результат запроса»;
</li><li>отдельная обработка SELECT-запросов с <nobr><tt>LIMIT</tt></nobr> (MySQL) или <nobr><tt>FIRST ? SKIP ?</tt></nobr> (InterBase/FireBird);
</li><li>работа с последовательностями (поддерживается далеко не всеми СУБД, а эмуляция весьма "кривая").
</li></ul>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
К счастью, используя PEAR DB и ADOdb, можно написать собственную «обертку», которая будет 
реализовывать всю функциональность из приведенного выше списка. Вероятно, в будущем она
и будет написана для DbSimple.
</div></td>
</tr>
</tbody></table></p>

<p>Сведя все воедино, можно сказать, что основная масса популярных библиотек абстракции 
от СУБД имеют три недостатка.
</p><ol>
<li>Весьма большой объем PHP-кода, который нужно подключать к скрипту. Например, 
минимальный набор файлов PEAR DB для работы с MySQL занимает порядка 150 КБ (5000 
строк кода), для ADOdb — 200 КБ и 7000 строк. Правда, это все включая комментарии,
которых в коде очень много, но все равно.

</li><li>Единый интерфейс оказывается уж очень «многословным» и чрезмерно перегруженным
ненужными (в большинстве случаев) функциями, в которых немудрено запутаться. 
Наоборот, некоторые возможности, которые применяются в скриптах очень часто 
(см. ниже), ими напрямую не поддерживаются. Иными словами, определенный слой 
абстракции данные библиотеки поддерживают, но это не совсем тот слой, с которыми
бы «хотели» работать скрипты: он слишком низкоуровневый.

</li><li>Отладочные функции находятся в зачаточном состоянии, а также работают не 
на том слое абстракции, на котором их бы «хотели видеть» скрипты. Например,
самая естественная отладочная информация — какие запросы с какими параметрами
выполнялись в ходе всей работы скрипта, какие результаты они вернули (хотя бы
число строк), где именно в PHP-коде вызывались и сколько времени заняли. Для всего 
этого поддержка в PEAR DB и ADODB отсутствует.
</li></ol>



<h2><a name="cont2"></a><span style="font-size: 18pt">Библиотека DbSimple</span></h2>

<p>Вашему вниманию предоставляется новая библиотека работы с СУБД — 
<a href="http://dklab.ru/lib/DbSimple/demo/lib/">DbSimple</a>. Вот ее основные характеристики.

</p><ul>
<li>Исключительно простой и лаконичный интерфейс, который очень удобно использовать в скриптах.
</li><li>Условные макроподстановки в теле SQL-запросах (<nobr><tt>{}</tt></nobr>-блоки), позволяющие делать динамически 
изменяемыми даже очень сложные запросы без ущерба читабельности кода.
</li><li>Выполнены все требования списка, приведенного выше. Чуть ниже будут даны подробные примеры 
по каждому из пунктов.
</li><li>Библиотека весьма компактна: например, объем кода для работы с MySQL — 40 КБ (1300 строк);
в основном, как водится, комментарии.
</li><li>В настоящий момент поддерживаются три популярные СУБД: MySQL, PostgreSQL и InterBase/FireBird. 
Поддержка остальных СУБД может быть добавлена без каких-либо проблем. Возможно даже добавление 
универсальной поддержки для PEAR DB, ADOdb или PDO, однако это, конечно, подорвет компактность 
библиотеки, но без ущерба остальным достоинствам.
</li><li>Код библиотеки оформлен в соответствии с 
<a href="http://pear.php.net/manual/ru/standards.php">PEAR Coding Standards</a>.
</li></ul>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Обращаю особое внимание на то, что DbSimple намеренно не занимается «выравниваниием диалектов» 
SQL в различных СУБД (что частично пытаются делать PEAR DB и ADOdb). Она лишь позволяет обращаться к 
ним через единый стандартизированный и очень удобный интерфейс. Что такое «выравнивание диалектов»? 
Например, в MySQL запрос с ограничением выглядит как "SELECT ... LIMIT m, n", в PostgreSQL — как 
"SELECT ... OFFSET x LIMIT y", а в FireBird — "SELECT FIRST a SKIP b ...". Это и есть «разные 
диалекты». Вы должны сами решить, какую СУБД используете, и соответствующим образом составлять 
запросы; DbSimple вам в этом не поможет (по крайней мере, это не тот слой абстракции, на котором
осуществляется выравнивание диалектов). Также DbSimple не является слоем получения 
стандартизированных метаданных БД (информации о структуре таблиц, полей, индексов и т.&nbsp;д.).
</i></p></td>
</tr>
</tbody></table></p>


<h3><a name="cont3"></a>DSN-подключение к БД</h3>

<p>В простейшем случае код подключения к БД будет выглядеть примерно так:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list1" href="http://dklab.ru/lib/DbSimple/manual.html#list1" title="Ссылка на текущий листинг.">Листинг 1</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px"><font color="green">// Подключаем библиотеку.</font>
require_once "DbSimple/Generic.php";
<font color="green">// Устанавливаем соединение.</font>
$DB = DbSimple_Generic::connect("mysql://Логин:Пароль@Хост/База");
<font color="green">// Дальше работаем с соединением (или текущей транзакцией) $DB. </font>
<font color="green">// Например: $DB-&gt;select(...).</font></pre></font></td>
  </tr>
</tbody></table></p>

<p>Формат DSN-строки тот же самый, что используется в PEAR DB. Для других СУБД DSN-строка 
может выглядеть более сложно. Спецификация параметров, следующих после "?" в DSN, 
определяется конкретной библиотекой поддержки той или иной СУБД. Вот пример для InterBase/FireBird:
<nobr><tt>ibase://Логин:Пароль@Хост/База?ROLE=...&amp;CHARSET=win1251&amp;BUFFERS=0&amp;DIALECT=3</tt></nobr>. 

</p><p>Статическая функция <nobr><tt>DbSimple_Generic::connect</tt></nobr> работает так:
</p><ol>
<li>Разбирает DSN-строку, выделяя имя СУБД.
</li><li>Пытается подключить файл <nobr><tt>ИмяСУБД.php</tt></nobr>, находящейся в пределах директории библиотеки 
DbSimple.
</li><li>Создает объект класса <nobr><tt>DbSimple_ИмяСУБД</tt></nobr>, который и возвращается.
</li></ol>

<p>Например, в нашем случае в <nobr><tt>$DB</tt></nobr> будет записан объект класса <nobr><tt>DbSimple_Mysql</tt></nobr>.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
В случае, если возникнет ошибка подключения, никакое сообщение выведено <i>не будет</i>,
и работа программы не завершится. Ошибка будет сгенерирована только при назначении 
функции-обработчика ошибок. Это может показаться неудобным, однако следующий раздел 
расставит все на свои места.
</div></td>
</tr>
</tbody></table></p>


<h3><a name="cont4"></a>Обработка ошибок</h3>

<p>Нечего даже и думать работать с базой, пока вы не убедитесь, что у вас есть удобный
инструмент для обработки ошибок. Ошибки могут возникать на самых разных местах, таких 
как: подключение к БД, выполнение SQL-запросов, старт транзакции и т.&nbsp;д. Все эти ситуации
обрабатываются библиотекой DbSimple единообразно — при помощи запуска <i>пользовательского 
обработчика ошибок</i> (error handler):


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list2" href="http://dklab.ru/lib/DbSimple/manual.html#list2" title="Ссылка на текущий листинг.">Листинг 2</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px"><span style="background:#DDDDDD">&lt;?php</span> #<font color="green"># Подключение к БД.</font>
require_once "../../lib/config.php";
require_once "DbSimple/Generic.php";

<font color="green">// Подключаемся к БД.</font>
$DATABASE = DbSimple_Generic::connect('mysql://test:test@localhost1/non-existed-db');

<font color="green">// Устанавливаем обработчик ошибок.</font>
$DATABASE-&gt;setErrorHandler('databaseErrorHandler');

<font color="green">// Код обработчика ошибок SQL.</font>
function databaseErrorHandler($message, $info)
{
    <font color="green">// Если использовалась @, ничего не делать.</font>
    if (!error_reporting()) return;
    <font color="green">// Выводим подробную информацию об ошибке.</font>
    echo "SQL Error: $message&lt;br&gt;&lt;pre&gt;"; 
    print_r($info);
    echo "&lt;/pre&gt;";
    exit();
}
<span style="background:#DDDDDD">?&gt;</span></pre></font></td>
  </tr>
</tbody></table></p>

<p>Обратите внимание на то, что мы выполняем <nobr><tt>$DB-&gt;setErrorHandler('databaseErrorHandler')</tt></nobr> 
<i>сразу же</i> после того, как установили подключение к БД (создали объект <nobr><tt>$DB</tt></nobr>).
Как уже говорилось выше, если во время вызова <nobr><tt>connect()</tt></nobr> произошла ошибка, она нигде
не отобразится, но последующий вызов <nobr><tt>setErrorHandler()</tt></nobr> ее <i>обработает</i> стандартным 
способом.



</p><h4><a name="cont5"></a>Пример ошибки подключения</h4>

<p>Предположим, мы допустили опечатку и попытались присоединиться к хосту <nobr><tt>localhost1</tt></nobr>, 
а не <nobr><tt>localhost</tt></nobr>. В этом случае во время установки обработчика ошибок будет выведено
следующее сообщение:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list3" href="http://dklab.ru/lib/DbSimple/manual.html#list3" title="Ссылка на текущий листинг.">Листинг 3</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">SQL Error: Unknown MySQL Server Host 'localhost1' (11001) at .../connect.php line 17
Array
(
    [code] =&gt; 2005
    [message] =&gt; Unknown MySQL Server Host 'localhost1' (11001)
    [query] =&gt; mysql_connect()
    [context] =&gt; .../connect.php line 17
)</pre></font></td>
  </tr>
</tbody></table></p>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Конечно, при желании вы можете оформить сообщение об ошибке гораздо аккуратнее. 
Вы можете даже записать его в логи сервера, а не выводить на экран.
</i></p></td>
</tr>
</tbody></table></p>

<p>Как видите, ошибка подключения не была «потеряна». Отображается: код ошибки, подробное сообщение, 
ошибочный SQL-запрос (в нашем случае это не запрос, а вызов функции подключения), а также имя
файла и номер строки, в которых была вызвана библиотека DbSimple.



</p><h4><a name="cont6"></a>Ошибки и исключения</h4>

<p>Помимо вывода диагностики, какова должна быть реакция скрипта на возникновение ошибки 
в SQL-запросе? Существует как минимум два варианта:
</p><ol>
<li>Вернуть какое-нибудь недопустимое значение вместо результирующих данных. Так поступает PEAR DB: 
если запрос завершается неудачно, возвращается признак ошибки — объект класса <nobr><tt>PEAR_Error</tt></nobr>, и вы 
должны проверять наличие этого признака явно.
</li><li>Немедленно завершить работу программы.
</li></ol>

<p>Первый способ неудобен тем, что расставлять повсюду в скрипте проверки весьма утомительно. Возникает
соблазн этого не делать, а значит, потенциальная возможность «упустить» ошибку. Моя практика показала, 
что в подавляющем большинстве случаев самое логичное, что можно сделать при возникновении SQL-ошибки, — 
это немедленно завершить работу скрипта. Ведь код, выполняющий SQL-запрос, ожидает получить его результат
и чаще всего не готов к тому, что «кина не будет».

</p><p>Но, конечно, бывают и ситуации, когда ошибку необходимо «молча проглотить». Самый распространенный
пример: нам нужно обновить некоторую запись в таблице, если она там уже существует, или добавить 
новую — если ее там нет. С использованием DbSimple и того обработчика ошибок,
который мы написали выше, это будет выглядеть примерно так:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list4" href="http://dklab.ru/lib/DbSimple/manual.html#list4" title="Ссылка на текущий листинг.">Листинг 4</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px"><font color="green">// Обратите внимание на "@"!</font>
if (!@$DB-&gt;query('UPDATE tbl SET field=? WHERE id=1', $field)) {
  <font color="green">// Здесь идет реакция на ошибку, если она возникла. </font>
  <font color="green">// Контекст ошибки можно получить через $DB-&gt;error.</font>
  $DB-&gt;query('INSERT INTO tbl(id, field) VALUES(1, ?)', $field)
}</pre></font></td>
  </tr>
</tbody></table></p>

<p>Взгляните еще раз на код callback-функции <nobr><tt>databaseErrorHandler()</tt></nobr> выше. Применение инструкции 
<nobr><tt>if (!error_reporting()) return</tt></nobr> заставляет обработчик не завершать работу скрипта (и не выводить 
диагностику), если вызову SQL-запроса предшествовал оператор PHP <nobr><tt>@</tt></nobr>. Таким образом, мы имеем 
возможность задействовать оба варианта реакции на ошибку, причем по умолчанию используется тот 
вариант, который оказывается самым логичным в большинстве случаев (второй).

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Конечно, идеальным решением было бы не завершать скрипт по <nobr><tt>exit()</tt></nobr>, а генерировать <nobr><tt>исключение</tt></nobr> 
инструкцией <nobr><tt>throw</tt></nobr>, которое потом будет перехвачено в блоке <nobr><tt>catch</tt></nobr>. Однако исключения поддерживаются
только в PHP5. Если вы используете PHP5, вы можете доработать функцию-обработчик ошибки так, чтобы
она генерировала исключение вместо завершения работы всей программы. Подробнее об исключениях 
читайте в <a href="http://www.php.net/manual/ru/language.exceptions.php">документации PHP</a>.
</div></td>
</tr>
</tbody></table></p>



<h3><a name="cont7"></a>Основные placeholder-ы</h3>

<p>Чтобы избежать самой популярной среди скриптописателей 
проблемы с безопасностью — SQL Injection, существует хороший способ: использовать в запросах
placeholder-ы и переложить обработку «небезопасных» данных на плечи библиотеки работы с СУБД
(см. <a href="http://dklab.ru/lib/Database_Placeholder">статью</a> на эту тему). Иными словами, там, где
«плохой» программист пишет «дырявый» код:

</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list5" href="http://dklab.ru/lib/DbSimple/manual.html#list5" title="Ссылка на текущий листинг.">Листинг 5</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$DB-&gt;select("SELECT * FROM tbl WHERE a='$a' AND b='$b'");</pre></font></td>
  </tr>
</tbody></table></p>
«хороший» применит placeholder-ы:

<p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list6" href="http://dklab.ru/lib/DbSimple/manual.html#list6" title="Ссылка на текущий листинг.">Листинг 6</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$DB-&gt;select('SELECT * FROM tbl WHERE a=? AND b=?', $a, $b);</pre></font></td>
  </tr>
</tbody></table></p>
и, тем самым, гарантированно избавит себя от дыр вида SQL Injection. Основными для DbSimple 
являются placeholder-ы <nobr><tt>?</tt></nobr> (вставка строки) и <nobr><tt>?a</tt></nobr> 
(вставка списка или массива). Они используются в подавляющем большинстве случаев.



<h4><a name="cont8"></a>Строковой (бинарный): ?</h4>

<p>Это самый простой вид placeholder-а, используемый в подавляющем большинстве случаев. 
Вставляемое на его место значение обрамляется апострофами ('), при этом все символы, 
которые СУБД считает служебными, экранируются в соответствии с правилами этой СУБД 
(например, в MySQL перед апострофами вставляется \, а в FireBird - апострофы удваиваются).


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list7" href="http://dklab.ru/lib/DbSimple/manual.html#list7" title="Ссылка на текущий листинг.">Листинг 7</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$DB-&gt;select('SELECT * FROM tbl WHERE a=?', "test'string");
<font color="green">// MySQL: SELECT * FROM tbl WHERE a='test\'string'</font>
<font color="green">// FireBird: SELECT * FROM tbl WHERE a='test''string'</font></pre></font></td>
  </tr>
</tbody></table></p>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Правила экранирования задаются для каждой СУБД отдельно. За это отвечает
виртуальный метод <nobr><tt>escape()</tt></nobr>.
</div></td>
</tr>
</tbody></table></p>

<p>Правильнее было бы назвать данный placeholder не строковым, а бинарным, т.к.
с его помощью в БД можно вставлять произвольные бинарные данные (в том числе
— картинки, исполняемые файлы и т.&nbsp;д.).

</p><p>Если значение подставляемого параметра равно <nobr><tt>null</tt></nobr>, вместо обрамления его 
апострофами вставляется ключевое слово SQL NULL. Это же верно и для всех 
остальных типов placeholder-ов.


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list8" href="http://dklab.ru/lib/DbSimple/manual.html#list8" title="Ссылка на текущий листинг.">Листинг 8</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$DB-&gt;query('UPDATE tbl SET a=?', null);
<font color="green">// MySQL: UPDATE tbl SET a=NULL</font></pre></font></td>
  </tr>
</tbody></table></p>



<h4><a name="cont9"></a>Списковый/ассоциативный: ?a</h4>

<p>Данный вид placeholder-ов удобно использовать для составления 
IN-выражений в SQL — при условии, что в программе имеется список
с перечисленными значениями:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list9" href="http://dklab.ru/lib/DbSimple/manual.html#list9" title="Ссылка на текущий листинг.">Листинг 9</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$ids = array(1, 101, 303);
$DB-&gt;select('SELECT name FROM tbl WHERE id IN(?a)', $ids);
<font color="green">// SELECT name FROM tbl WHERE id IN(1, 101, 303)</font></pre></font></td>
  </tr>
</tbody></table></p>

<p>Помните, что в случае передачи пустого списка вы получите 
ошибочный SQL-запрос:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list10" href="http://dklab.ru/lib/DbSimple/manual.html#list10" title="Ссылка на текущий листинг.">Листинг 10</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$ids = array();
$DB-&gt;select('SELECT name FROM tbl WHERE id IN(?a)', $ids);
<font color="green">// SELECT name FROM tbl WHERE id IN() - ОШИБКА!</font></pre></font></td>
  </tr>
</tbody></table></p>

<p>Если в качестве параметра передан ассоциативный массив (ключи 
массива не целочисленные, а строковые), DbSimple заменяет <nobr><tt>?a</tt></nobr>  
набором пар <nobr><tt>ключ=значение</tt></nobr>. Это удобно использовать в UPDATE-запросах:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list11" href="http://dklab.ru/lib/DbSimple/manual.html#list11" title="Ссылка на текущий листинг.">Листинг 11</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$row = array(
  'id'   =&gt; 10,
  'date' =&gt; "2006-03-02"
);
$DB-&gt;query('UPDATE tbl SET ?a', $row);
<font color="green">// MySQL: UPDATE tbl SET `id`='10', `date`='2006-03-02'</font></pre></font></td>
  </tr>
</tbody></table></p>



<h3><a name="cont10"></a>Дополнительные placeholder-ы</h3>

<p>Для удобства работы DbSimple поддерживает еще целый набор видов 
placeholder-ов, которые будут описаны далее. Они используются значительно
реже и, как правило, позволяют просто сократить письмо. Если вы думаете,
что все это слишком сложно для понимания, — не используйте дополнительные 
placeholder-ы.



</p><h4><a name="cont11"></a>Префиксный: ?_</h4>

<p>Часто все имена таблиц, используемых в программе, имеют один
и тот же префикс. Например, в форуме phpBB этот префикс, как правило, 
равен <nobr><tt>phpbb_</tt></nobr>, и таблицы называются <nobr><tt>phpbb_users</tt></nobr>, <nobr><tt>phpbb_sessions</tt></nobr> и 
т.&nbsp;д. Это делается для того, чтобы в одной базе данных можно было хранить
сразу несколько наборов таблиц для разных форумов, избегая конфликтов 
имен.

</p><p>Префиксный placeholder заменяется на некоторое фиксированное значение, 
ранее установленное для объекта базы данных:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list12" href="http://dklab.ru/lib/DbSimple/manual.html#list12" title="Ссылка на текущий листинг.">Листинг 12</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">define(TABLE_PREFIX, 'phpbb_'); <font color="green">// с подчерком!</font>
$DB-&gt;setIdentPrefix(TABLE_PREFIX); 
...
$DB-&gt;select('SELECT * FROM ?_users');
<font color="green">// SELECT * FROM phpbb_users</font>

<font color="green">// Сравните:</font>
$DB-&gt;select('SELECT * FROM '.TABLE_PREFIX.'_users');</pre></font></td>
  </tr>
</tbody></table></p>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Если быть точным, <nobr><tt>?_</tt></nobr> не является обычным placeholder-ом, т.к. для него
очередное значение не извлекается из списка параметров, а берется из
другого источника. Это скорее удобная макроподстановка.
</i></p></td>
</tr>
</tbody></table></p>



<h4><a name="cont12"></a>Идентификаторный: ?#</h4>

<p>Ключевые слова SQL, такие как <nobr><tt>date</tt></nobr>, <nobr><tt>int</tt></nobr> и т.&nbsp;д., не могут использоваться в 
качестве имен полей и таблиц. Например, у вас не получится создать в таблице
столбец с именем <nobr><tt>date</tt></nobr>. Тем не менее, многие СУБД предлагают способы,
позволяющие все же ссылаться на подобные объекты. Имена идентификаторов
следует окружить теми или иными ограничителями:

</p><ul>
<li>MySQL использует обратные апострофы (backticks): table.`date`.
</li><li>FireBird заставляет применять кавычки: table."date".
</li><li>Microsoft SQL Server использует квадратные скобки: table.[date].
</li></ul>

<p>Идентификаторный placeholder заставляет СУБД воспринимать значение 
как идентификатор:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list13" href="http://dklab.ru/lib/DbSimple/manual.html#list13" title="Ссылка на текущий листинг.">Листинг 13</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$DB-&gt;select('SELECT ?<font color="green"># FROM tbl', 'date');</font>
<font color="green">// MySQL: SELECT `date` FROM tbl</font>
<font color="green">// FireBird: SELECT "date" FROM tbl</font>

$DB-&gt;select('SELECT ID AS ?<font color="green"># FROM tbl', 'this is ID');</font>
<font color="green">// MySQL: SELECT ID AS `this is ID` FROM tbl</font>
<font color="green">// FireBird: SELECT ID AS "this is ID" FROM tbl</font></pre></font></td>
  </tr>
</tbody></table></p>

<p>Конечно, использование идентификаторного placeholder-а полностью защищает
от уязвимостей вида SQL Injection. Передаваемый параметр обрамляется
«идентификаторными кавычками», а если они встречаются в нем самом, то 
экранируются специфичным для СУБД образом.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Правила экранирования определятюся тем же самым виртуальным методом <nobr><tt>escape()</tt></nobr>. 
Для экранирования в стиле идентификаторов второй параметр полагается равным <nobr><tt>true</tt></nobr>.
</div></td>
</tr>
</tbody></table></p>



<h4><a name="cont13"></a>Идентификаторно-списковый: ?#</h4>

<p>Уже знакомый нам идентификаторный placeholder <nobr><tt>?#</tt></nobr> может принимать в качестве 
значения не только строку, но также и массив (список значений). Это очень удобно для 
формирования INSERT-запросов в соответствии со стандартом SQL'92:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list14" href="http://dklab.ru/lib/DbSimple/manual.html#list14" title="Ссылка на текущий листинг.">Листинг 14</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$row = array('id' =&gt; 101, 'name' =&gt; 'Rabbit', 'age' =&gt; 30);
$DB-&gt;query('INSERT INTO table(?#) VALUES(?a)', array_keys($row), array_values($row));</pre></font></td>
  </tr>
</tbody></table></p>

<p>В зависимости от того, передаете вы placeholder-у <nobr><tt>?#</tt></nobr> массив или строку, он 
"развернется" в список идентификаторов или в единственный идентификатор соответственно.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Вы можете спросить, почему же для вставки списка значений используется отдельный 
placeholder <nobr><tt>?a</tt></nobr>, а для списка идентификаторов — тот же самый <nobr><tt>?#</tt></nobr>. Ответ достаточно 
прост: применение <nobr><tt>?</tt></nobr> для обработки и скаляра, и списка небезопасно, т.к. данные могут быть получены 
из формы и представлены злоумышленником в виде массива. Например, можно передать 
<nobr><tt>id[]=1&amp;id[]=2</tt></nobr> вместо <nobr><tt>id=1</tt></nobr> в QUERY_STRING и "сломать" запрос <nobr><tt>$DB-&gt;select('SELECT * FROM table WHERE id=?', $_GET['id'])</tt></nobr>. 
В то же время, "фальсифицировать" передачу списка идентификаторов вместо единственного значения 
практически невозможно.
</i></p></td>
</tr>
</tbody></table></p>



<h4><a name="cont14"></a>Целочисленный: ?d</h4>

<p>Переданный параметр преобразуется в целое цисло и вставляется без 
обрамления апострофами. В случае ошибки конвертирования вставляется 0.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Может возникнуть вопрос, зачем нужны целочисленные placeholder-ы, если
СУБД и так умеют преобразовывать строки в числа? Например, MySQL 
конвертирует '10' в 10 при вставке в числовое поле. Оказывается, это
верно не для всех существующих в мире СУБД. Кроме того, предложение
<nobr><tt>FIRST ? SKIP ?</tt></nobr> FireBird (или <nobr><tt>LIMIT ?, ?</tt></nobr> MySQL) требует обязательной
подстановки чисел, а не строк.
</i></p></td>
</tr>
</tbody></table></p>



<h4><a name="cont15"></a>Вещественный (дробный): ?f</h4>

<p>Вещественный placeholder можно использовать для передачи дробных (вещественных)
чисел в СУБД. В зависимости от локальных настроек для разделения компонент
PHP использует либо точку, либо запятую, в то время как стандарт SQL требует
обязательного использования точки безотносительно к локальным настройкам. Чтобы 
не связываться с локальными настройками, просто применяйте дробный placeholder.



</p><h4><a name="cont16"></a>Ссылочный: ?n</h4>

<p>В большинстве таблиц, с которыми приходится работать, присутствует 
целочисленный столбец с именем <nobr><tt>ID</tt></nobr> — <i>первичный ключ</i> данной таблицы. 
На этот столбец устанавливают уникальный индекс и "навешивают" 
<nobr><tt>auto_increment</tt></nobr> (MySQL) или триггеры-генераторы (остальные СУБД), чтобы
при вставке очередной записи в таблицу она автоматически получала 
уникальный номер (как правило, отличный от нуля).

</p><p>На первичный ключ очень удобно ссылаться из другой (или из той же самой) 
таблицы, такие ссылки называют <i>внешними ключами</i>. Например, у нас 
может быть таблица <nobr><tt>forest</tt></nobr> с полями <nobr><tt>(ID, PARENT_ID, NAME)</tt></nobr>, 
определяющая множество деревьев. Чтобы не нарушать ссылочной целостности, 
корневой элемент каждого дерева должен иметь <nobr><tt>PARENT_ID=NULL</tt></nobr>.

</p><p>Предположим, мы пишем скрипт, который вставляет в <nobr><tt>forest</tt></nobr> 
новую запись. ID родительского узла передается так: 
<nobr><tt>http://example.com/tree.php?parent=123</tt></nobr>. Что делать, когда нам нужно
передать NULL в качестве идентификатора родителя?


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list15" href="http://dklab.ru/lib/DbSimple/manual.html#list15" title="Ссылка на текущий листинг.">Листинг 15</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$DB-&gt;query(
  'INSERT INTO forest(PARENT_ID, NAME) VALUES(?, ?)', 
  ($_GET['parent']? $_GET['parent'] : null), $name
);</pre></font></td>
  </tr>
</tbody></table></p>

<p>Теперь можно передать в GET-параметр <nobr><tt>parent</tt></nobr> значение "" или 0 для вставки NULL.

</p><p>Ссылочный placeholder позволяет немного упростить письмо:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list16" href="http://dklab.ru/lib/DbSimple/manual.html#list16" title="Ссылка на текущий листинг.">Листинг 16</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$DB-&gt;query(
  'INSERT INTO forest(PARENT_ID, NAME) VALUES(?n, ?)', 
  $_GET['parent'], $name
);</pre></font></td>
  </tr>
</tbody></table></p>

<p>Подставляемое значение преобразуется в целое число. Если это число
равно нулю, то вместо него подставляется <nobr><tt>NULL</tt></nobr>, иначе — оно само.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Ссылочный placeholder крайне удобно применять для "выправления" баз данных
MySQL типа MyISAM, если для "узлов-сирот" применялся не <nobr><tt>NULL</tt></nobr> в качестве
родителя, а обычный 0. К сожалению, такое часто встречается на практике, т.к. 
MyISAM, в отличие от BDB и InnoDB, не поддерживает ссылочную целостность,
а написать <nobr><tt>PARENT_ID=?</tt></nobr> вместо <nobr><tt>PARENT_ID&lt;=&gt;?</tt></nobr> бывает весьма заманчиво. 
(См. <a href="http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html">документацию MySQL</a> на операторы <nobr><tt>IS_NULL</tt></nobr> и &lt;=&gt; в отношении NULL-значений.)
</div></td>
</tr>
</tbody></table></p>





<h3><a name="cont17"></a>«Родные» placeholder-ы базы</h3>

<p>Некоторые СУБД (например, InterBase/FireBird) сами поддерживают 
placeholder-ы. Правда, их набор обычно ограничивается одним-единственным
видом: скалярным placeholder-ом "?", применяемым как для строк, так и для
целых и дробных чисел:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list17" href="http://dklab.ru/lib/DbSimple/manual.html#list17" title="Ссылка на текущий листинг.">Листинг 17</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">ibase_query($link, 'SELECT * FROM tbl WHERE id=?', 100);</pre></font></td>
  </tr>
</tbody></table></p>

<p>Естественно, быстродействие от применения "родных" placeholder-ов 
базы только увеличивается (нет необходимости преобразовывать данные
в строковой SQL-запрос), поэтому DbSimple, где это возможно, 
применяет встроенные placeholder-ы. Например, их поддержка реализована
в модуле работы с InterBase.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Отдельную сложность при работе с "родными" placeholder-ами составляет
логирование запросов к СУБД, также поддерживаемое DbSimple. Действительно,
в журнал должны идти запросы с уже проставленными параметрами. Поэтому
DbSimple при включенном логировании "расширяет" placeholder-ы самостоятельно.
</i></p></td>
</tr>
</tbody></table></p>

<p>В качестве "родных" placeholder-ов могут использоваться только строковой 
(<nobr><tt>?</tt></nobr>) и численный (<nobr><tt>?d</tt></nobr> и <nobr><tt>?f</tt></nobr>) placeholder-ы. Все остальные типы (в том 
числе списковый, идентификаторный и т.&nbsp;д.) по-прежнему обрабатываются самой
библиотекой DbSimple.



</p><h3><a name="cont18"></a>Выполнение запросов к БД</h3>

<p>Библиотека DbSimple имеет в своем имени слово simple ("простой") потому,
что она максимально упрощает процедуру выполнения запросов к базе данных.



</p><h4><a name="cont19"></a>Выборка всего результата: select()</h4>

<p>Данный метод является самым простым и универсальным. С его помощью вы можете
выполнить запрос к базе данных и (если это SELECT-запрос) получить в двумерный
массив все строки результата операции.


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list18" href="http://dklab.ru/lib/DbSimple/manual.html#list18" title="Ссылка на текущий листинг.">Листинг 18</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$rows = $DB-&gt;select(
  'SELECT * FROM ?_users WHERE username LIKE ?', 'к%'
);
foreach ($rows as $numRow=&gt;$row) {
  foreach ($row as $colName=&gt;$cellValue) {
    echo "$numRow: $colName = $cellValue&lt;br&gt;";
  }
}</pre></font></td>
  </tr>
</tbody></table></p>

<p>Если вам не нужны все строки результата, ограничьте выборку стаднартными
средствами SQL — например, предложением <nobr><tt>LIMIT</tt></nobr> в MySQL:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list19" href="http://dklab.ru/lib/DbSimple/manual.html#list19" title="Ссылка на текущий листинг.">Листинг 19</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$rows = $DB-&gt;select('SELECT * FROM ?_users LIMIT 10');
foreach ($rows as $numRow=&gt;$row) {
  ...
}</pre></font></td>
  </tr>
</tbody></table></p>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Обратите внимание, что промежуточный слой абстракции "объект-результат"
не используется, а выборка в любом случае производится полностью, от
первой записи до последней. Это сделано совсем не случайно: я имею
твердую уверенность, что данный слой абстракции в скриптах совершенно
излишен и только запутывает программу. Хотите ограничить выборку или
устроить выборочную навигацию по результату (seeking) — используйте
для этого средства SQL, а не PHP.
</div></td>
</tr>
</tbody></table></p>



<h5><a name="cont20"></a>Выборка ассоциативного массива</h5>

<p>Результат выборки, который попал в <nobr><tt>$rows</tt></nobr> (см. предыдущий пример),
является <i>списком массивов</i>. Иными словами, ключи <nobr><tt>$rows</tt></nobr> — 
целые числа, большие либо равные нулю и идущие по порядку.

</p><p>В ряде случаев оказывается удобным индексировать результат не целыми
числами, а ассоциативными значениями, взятыми в одном из столбцов 
выборки. Например, если мы выбираем пользователей, в качестве ключа 
может быть использован их primary key в базе (идентификатор).

</p><p>Чтобы DbSimple сформировал ассоциативный массив, а не список, 
используйте для столбца фиксированное имя <nobr><tt>ARRAY_KEY</tt></nobr>:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list20" href="http://dklab.ru/lib/DbSimple/manual.html#list20" title="Ссылка на текущий листинг.">Листинг 20</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$rows = $DB-&gt;select(
  'SELECT user_id AS ARRAY_KEY, * FROM ?_users'
);
foreach ($rows as $userId=&gt;$userData) {
  ...
}
echo $rows[$_REQUEST['uid']]['username'];
echo $rows[$_REQUEST['uid']]['ARRAY_KEY']; <font color="green">// ошибка: нет поля</font></pre></font></td>
  </tr>
</tbody></table></p>

<p>По наличию столбца с именем <nobr><tt>ARRAY_KEY</tt></nobr> библиотека определит, какой
формат данных вы ожидаете получить, и произведет соответствующие 
преобразования. Т.к. этот столбец является служебным, он сам в результат
выборки не попадет (см. последнюю строчку примера).


</p><h5><a name="cont21"></a>Выборка многомерного массива</h5>

<p>Если результат выборки необходимо оформить в виде многомерного ассоциативного 
массива, используйте следующий синтаксис:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list21" href="http://dklab.ru/lib/DbSimple/manual.html#list21" title="Ссылка на текущий листинг.">Листинг 21</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$messagesByTopics = $DB-&gt;select('
    SELECT 
        message_topic_id AS ARRAY_KEY_1,
        message_id AS ARRAY_KEY_2,
        message_subject, message_text
    FROM 
        ?_message
');</pre></font></td>
  </tr>
</tbody></table></p>

<p>На выходе получится <i>двумерный</i> ассоциативный массив: <nobr><tt>$messagesByForumsAndTopics[topicId][messageId] = messageData</tt></nobr>. 
Поле <nobr><tt>message_topic_id</tt></nobr>, объявленное как <nobr><tt>ARRAY_KEY_1</tt></nobr>, стало первым индексом массива, а поле <nobr><tt>message_id</tt></nobr> (<nobr><tt>ARRAY_KEY_2</tt></nobr>) — вторым.

</p><p>Существует и специальный вариант данного синтаксиса, позволяющий формировать индексы массивов в возрастающем порядке,
а не на основе величины, полученной из БД:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list22" href="http://dklab.ru/lib/DbSimple/manual.html#list22" title="Ссылка на текущий листинг.">Листинг 22</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$usersByCity = $DB-&gt;select('
    SELECT 
        city_id AS ARRAY_KEY_1, 
        NULL AS ARRAY_KEY_2,
        user_name, user_email
    FROM 
        ?_user
');</pre></font></td>
  </tr>
</tbody></table></p>

<p>В данном примере будет получен <i>массив списков пользователей</i> <nobr><tt>$usersByCity[cityId][] = userData</tt></nobr>. Т.е. каждый 
элемент массива, соответствующий некоторому городу, содержит <i>обычный список</i> записей с данными пользователей. Мы достигли
получения обычного списка, передав <nobr><tt>NULL</tt></nobr> в качестве <nobr><tt>ARRAY_KEY_2</tt></nobr>.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Вообще, специальными являются все поля вида <nobr><tt>ARRAY_KEY*</tt></nobr> (здесь "*" означает "любой текст"). Перед формированием индексов
ассоциативного массива эти поля сортируются в алфавитном порядке, так что <nobr><tt>ARRAY_KEY_1</tt></nobr> всегда будет более "ранним" индексом,
чем <nobr><tt>ARRAY_KEY_2</tt></nobr>.
</div></td>
</tr>
</tbody></table></p>


<h5><a name="cont22"></a>Выборка связанного дерева</h5>

<p>Иногда в таблице хранится древовидная структура: каждая запись содержит
поле <nobr><tt>parent_id</tt></nobr>, ссылающееся на ID родительского элемента. DbSimple 
облегчает выборку и такой структуры, формируя вложенные древовидным 
образом массивы:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list23" href="http://dklab.ru/lib/DbSimple/manual.html#list23" title="Ссылка на текущий листинг.">Листинг 23</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$forest = $DB-&gt;select('
  SELECT 
    user_id   AS ARRAY_KEY, 
    parent_id AS PARENT_KEY,
    * 
  FROM ?_users
');</pre></font></td>
  </tr>
</tbody></table></p>

<p>Строго говоря, на выходе в <nobr><tt>$forest</tt></nobr> мы получаем не дерево, а <i>лес</i> — 
набор однокоренных деревьев. Дело в том, что в результатах выборки могут
присутствовать сразу несколько элементов, не имеющих родителей.
Все такие элементы объявляются вершинами дерева, а их "дети" строятся
по правилу: <nobr><tt>PARENT_KEY</tt></nobr> "ребенка" равен <nobr><tt>ARRAY_KEY</tt></nobr> "родителя".

</p><p>У каждого элемента результирующего массива, помимо его собственных
данных (в нашем случае это <nobr><tt>*</tt></nobr> — все поля записи), имеется запись
с ключом <nobr><tt>childNodes</tt></nobr>. В ней-то и содержится массив всех "детей"
текущего элемента (или пустой массив, если это листовая вершина).



</p><h4><a name="cont23"></a>Выборка строки: selectRow()</h4>

<p>Выше мы видели, что, используя один-единственный метод <nobr><tt>select()</tt></nobr>,
можно осуществлять любые выборки из базы данных, по желанию форматируя
их в виде ассоциативного массива или дерева.

</p><p>Часто бывают случаи, когда выборка гарантировано состоит из одной 
записи. Предположим, у нас есть ID некоторого объекта, и мы хотим
получить данные его полей. Можно для этого воспользоваться методом 
<nobr><tt>select()</tt></nobr>, а потом взять первую строку результата, однако удобнее
будет применить метод <nobr><tt>selectRow()</tt></nobr>:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list24" href="http://dklab.ru/lib/DbSimple/manual.html#list24" title="Ссылка на текущий листинг.">Листинг 24</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$row = $DB-&gt;selectRow(
  'SELECT * FROM ?_users WHERE user_id=?', $uid
);
<font color="green">// Теперь в $row - массив вида имяПоля =&gt; значениеПоля.</font></pre></font></td>
  </tr>
</tbody></table></p>



<h4><a name="cont24"></a>Выборка ячейки: selectCell()</h4>

<p>Иногда нам нужны данные в еще более простом формате, чем 
выдает <nobr><tt>selectRow()</tt></nobr>. Например, мы хотим получить имя
пользователя, зная его ID, и при этом совершенно не интересуемся
всеми остальными его полями. Метод <nobr><tt>selectCell()</tt></nobr> подходит
здесь как нельзя лучше:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list25" href="http://dklab.ru/lib/DbSimple/manual.html#list25" title="Ссылка на текущий листинг.">Листинг 25</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$userName = $DB-&gt;selectCell(
  'SELECT username FROM ?_users WHERE user_id=?', $uid
);
<font color="green">// В $userName - строка, имя пользователя.</font></pre></font></td>
  </tr>
</tbody></table></p>



<h4><a name="cont25"></a>Выборка столбца: selectCol()</h4>

<p>Последний вид форматирования результатов выборки — получение
одного столбца. Метод <nobr><tt>selectCol()</tt></nobr> трактует результат как
массив-столбец и возвращает данные в виде списка:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list26" href="http://dklab.ru/lib/DbSimple/manual.html#list26" title="Ссылка на текущий листинг.">Листинг 26</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$cities = $DB-&gt;selectCol('SELECT city_name FROM ?_cities');
<font color="green">// В $cities - список имен всех городов.</font></pre></font></td>
  </tr>
</tbody></table></p>

<p>Можно также индексировать массив ассоциативными значениями, а не 
целыми числами. Это делается при помощи служебного поля 
с уже знакомым именем <nobr><tt>ARRAY_KEY</tt></nobr>:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list27" href="http://dklab.ru/lib/DbSimple/manual.html#list27" title="Ссылка на текущий листинг.">Листинг 27</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$citiesById = $DB-&gt;selectCol(
  'SELECT city_id AS ARRAY_KEY, city_name FROM ?_cities'
);
foreach ($citiesById as $id=&gt;$name) { ... }</pre></font></td>
  </tr>
</tbody></table></p>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Кстати говоря, результат, полученный в предыдущем примере, можно
"один-в-один" использовать вместе с библиотекой 
<a href="http://dklab.ru/lib/HTML_FormPersister/">HTML_FormPersister</a>,
сформировав из него выпадающий список городов (SELECT).
</i></p></td>
</tr>
</tbody></table></p>



<h4><a name="cont26"></a>Выборка страницы: selectPage()</h4>

<p>Организация страничного навигатора по некоторому результату выборки 
может оказаться настоящей головной болью, если не знать, как оптимальнее 
всего подойти к этому вопросу. Помимо выполнения запроса на получение 
строк очередной страницы нужно дополнительно подсчитывать <i>общее</i> 
число записей. Иными словами, нам нужен один запрос с предложением <nobr><tt>LIMIT</tt></nobr>, 
и один — с выборкой <nobr><tt>COUNT(*)</tt></nobr>.

</p><p>Метод <nobr><tt>selectPage()</tt></nobr> сводит эти две операции к одному вызову. С его
помощью вы передаете СУБД запрос с необходимыми вам <nobr><tt>LIMIT</tt></nobr>-ограничениями,
а библиотека дополнительно производит еще и <nobr><tt>COUNT</tt></nobr>-запрос:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list28" href="http://dklab.ru/lib/DbSimple/manual.html#list28" title="Ссылка на текущий листинг.">Листинг 28</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$rows = $DB-&gt;selectPage(
  $totalRows,
  'SELECT * FROM ?_users LIMIT ?d, ?d',
  $from, $pageSize
);
<font color="green">// Теперь:</font>
<font color="green">// - в $rows: данные очередной страницы</font>
<font color="green">// - в $totalRows: общее число записей в полной выборке</font></pre></font></td>
  </tr>
</tbody></table></p>

<p>Обратите особое внимание, что первый параметр метода является 
<b>ссылочным</b>: в переменную, указанную на его месте, 
записывается общее число попадающих под запрос записей,
без учета <nobr><tt>LIMIT</tt></nobr>-предложения.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Метод <nobr><tt>selectPage()</tt></nobr> можно использовать только для «простых» SQL-запросов, 
не содержащих предложение <nobr><tt>UNION</tt></nobr>. В противном случае результат не определен.
</div></td>
</tr>
</tbody></table></p>


<h4><a name="cont27"></a>Выполнение обновлений: query()</h4>

<p>Как видите, до сих пор повествование "крутилось" вокруг различных
вариаций метода <nobr><tt>select()</tt></nobr>, предназначенного для организации выборок
из базы данных (SELECT). Но ведь существуют еще и команды вставки
(INSERT) и обновления (UPDATE) данных. Как быть с ними?

</p><p>Библиотека DbSimple поддерживает метод <nobr><tt>query()</tt></nobr>, который удобно
использовать именно для подобных запросов. А теперь — сюрприз: 
<nobr><tt>query()</tt></nobr> является ни чем иным, как <i>полным синонимом</i> для 
пресловутого <nobr><tt>select()</tt></nobr>. А называется он по-другому, чтобы не 
пришлось думать: как это — <nobr><tt>INSERT</tt></nobr> в <nobr><tt>select()</tt></nobr>.

</p><p>Метод <nobr><tt>query()</tt></nobr> (а значит, и <nobr><tt>select()</tt></nobr> тоже!) возвращает 
различные значения для <nobr><tt>INSERT</tt></nobr> и <nobr><tt>UPDATE</tt></nobr>-запросов:

</p><ul>
<li>В <nobr><tt>UPDATE</tt></nobr>-запросах возвращается число строк, задействованных в
обновлении. Оно вполне может быть нулевым, что не является признаком 
ошибки.
</li><li>В <nobr><tt>INSERT</tt></nobr>-запросах возвращается значение автоинкрементного поля
(если оно имелось в таблице). Естественно, это работает только в СУБД,
поддерживающих auto_increment (например, в MySQL).
</li></ul>

<p>Вот несколько примеров:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list29" href="http://dklab.ru/lib/DbSimple/manual.html#list29" title="Ссылка на текущий листинг.">Листинг 29</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px"><font color="green">// Обновляем запись.</font>
$DB-&gt;query(
  'UPDATE ?_users SET ?a WHERE user_id=?',
  $userData, $userData['user_id']
);
<font color="green">// Вставляем запись (MySQL).</font>
$userId = $DB-&gt;query('INSERT INTO ?_users SET ?a', $userData);</pre></font></td>
  </tr>
</tbody></table></p>


<h4><a name="cont28"></a><a name="errhandle"></a>Обработка ошибок в запросах</h4>

<p><a href="http://dklab.ru/lib/DbSimple/manual.html#errhandle">Выше</a> было сказано, что при возникновении ошибки
запроса вызывается зарегистрированный ранее обработчик ошибок. Он, как правило, 
завершает работу скрипта и выдает исчерпывающую информацию о контексте вызова 
запроса. В большинстве случаев это поведение — самое разумное, однако для
некоторых запросов может понадобиться временно отключить стандартный механизм
и обработать ошибку вручную, непосредственно в коде программы.

</p><p>Библиотека DbSimple позволяет <i>позапросно</i> отключать обработку 
ошибок, используя для этого стандартную нотацию PHP — оператор <nobr><tt>@</tt></nobr>. 
Иными словами, поставив <nobr><tt>@</tt></nobr> перед вызовом любого из методов DbSimple,
вы заставите этот метод вернуть <nobr><tt>null</tt></nobr> в случае возникновения проблем.
Далее вы можете извлечь контекст выполнения запроса из свойства <nobr><tt>error</tt></nobr> 
(краткое описание ошибки — из <nobr><tt>errmsg</tt></nobr>) и поступить с этой информацией
так, как вам нужно.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Конечно, не следует злоупотреблять данной возможностью. Используйте ее 
только в случае, если вы точно уверены, что обрабатываете ошибку вручную
непосредственно после выполнения запроса.
</i></p></td>
</tr>
</tbody></table></p>

<p>Типичный пример: мы хотим вставить некоторую запись в таблицу, но,
если она там уже имеется (нарушение уникальности), не завершать работу 
программы, а выводить пользователю аккуратное предупреждение в форме. 
Это можно сделать так:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list30" href="http://dklab.ru/lib/DbSimple/manual.html#list30" title="Ссылка на текущий листинг.">Листинг 30</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px"><font color="green">// Предположим, по полю username имеется уникальный индекс.</font>
if (!@$DB-&gt;query('INSERT INTO ?_users SET username=?', $name)) {
  echo 'Такой пользователь уже существует, попробуйте другое имя';
}</pre></font></td>
  </tr>
</tbody></table></p>


<h3><a name="cont29"></a>Макроподстановки в SQL-запросах</h3>

<p>Каждый, кто писал скрипты со сложными запросами к СУБД, знает,
какие проблемы начинаются, если запрос требуется составлять динамически. 
Например, если нам требуется добавить в выражение WHERE некоторое ограничение,
если пользователь поставил галочку в форме, и не выполнять его в противном 
случае. Традиционно в таких случаях применяют динамическое составление 
SQL-запросов, формируя их в виде строки:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list31" href="http://dklab.ru/lib/DbSimple/manual.html#list31" title="Ссылка на текущий листинг.">Листинг 31</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$sql = '
    SELECT *
    FROM goods
    WHERE category_id = ?
';
if (!empty($_POST['activated_at'])) {
    $sql .= ' AND activated_at IS NOT NULL';
}
$sql .= " ORDER BY price";
$rows = $DB-&gt;select($sql, $categoryId);</pre></font></td>
  </tr>
</tbody></table></p>

<p>Теперь представьте, что на <nobr><tt>activated_at</tt></nobr> наложено более сложное условие, 
учитывающее также и его величину:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list32" href="http://dklab.ru/lib/DbSimple/manual.html#list32" title="Ссылка на текущий листинг.">Листинг 32</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$query = array($categoryId);
$sql = '
    SELECT *
    FROM goods
    WHERE category_id = ?
';
if (!empty($_POST['activated_at'])) {
    $sql .= ' AND activated_at &gt; ?';
    $placeholders[] = $_POST['activated_at'];
}
$sql .= " ORDER BY price";
array_unshift($query, $sql);
$rows = call_user_func_array(array(&amp;$DB, 'select'), $query);</pre></font></td>
  </tr>
</tbody></table></p>

<p>В примере выше мы используем всего одно динамическое поле, но на практике их 
может быть значительно больше. В результате читабельность кода резко снижается, не говоря
уж о читабельности генерируемых SQL-запросов...

</p><p>К счастью, данная проблема относится к классу беспроигрышно-разрешимых. А именно,
имеется такой синтаксис, который позволяет создавать динамические SQL-запросы без
какого-либо снижения читабельности кода! Он используется в DbSimple:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list33" href="http://dklab.ru/lib/DbSimple/manual.html#list33" title="Ссылка на текущий листинг.">Листинг 33</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$rows = $DB-&gt;select('
        SELECT *
        FROM goods
        WHERE 
            category_id = ?
          { AND activated_at &gt; ? }
    ',
    $categoryId,
    (empty($_POST['activated_at'])? DBSIMPLE_SKIP : $_POST['activated_at'])
);</pre></font></td>
  </tr>
</tbody></table></p>

<p>Обратите внимание на блок, обрамленный фигурными скобками (<nobr><tt>{}</tt></nobr>-блок). Нетрудно 
догадаться, как он работает: если хотя бы один placeholder, используемый в этом блоке,
имеет специальное значение <nobr><tt>DBSIMPLE_SKIP</tt></nobr>, то весь блок удаляется из запроса, в 
противном случае удаляются только обрамляющие фигурные скобки (точнее, они заменяются на 
пробелы, чтобы сформированный SQL-запрос хорошо читался).

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
В настоящий момент значение <nobr><tt>DBSIMPLE_SKIP</tt></nobr> определяется в библиотеке как <nobr><tt>log(0)</tt></nobr>. 
Т.к. логарифма нуля в природе не существует, константа принимает значение "недопустимое 
значение: логарифм нуля" (оказывается, есть в PHP такое значение для числа с плавающей 
точкой), и вероятность того, что кому-то потребуется вставить его в БД, падает до 
нуля (да оно и не вставится для большинства СУБД).
</i></p></td>
</tr>
</tbody></table></p>

<p>Начав однажды пользоваться <nobr><tt>{}</tt></nobr>-макросами, через некоторое время перестаешь понимать,
как же обходился без них раньше. Вот еще примеры запросов с макроподстановками:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list34" href="http://dklab.ru/lib/DbSimple/manual.html#list34" title="Ссылка на текущий листинг.">Листинг 34</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$rows = $DB-&gt;select('
        SELECT *
        FROM 
            goods g
          { JOIN category c ON c.id = g.category_id AND c.name = ? }
    ',
    (empty($_POST['cat_name'])? DBSIMPLE_SKIP : $_POST['cat_name'])
);</pre></font></td>
  </tr>
</tbody></table></p>


<p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list35" href="http://dklab.ru/lib/DbSimple/manual.html#list35" title="Ссылка на текущий листинг.">Листинг 35</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$rows = $DB-&gt;select('
        SELECT *
        FROM 
            goods g
          { JOIN category c ON c.id = g.category_id AND 1 = ? }
        WHERE 
            1 = 1
          { AND c.name = ? }
    ',
    (empty($_POST['cat_name'])? DBSIMPLE_SKIP : 1),
    (empty($_POST['cat_name'])? DBSIMPLE_SKIP : $_POST['cat_name'])
);</pre></font></td>
  </tr>
</tbody></table></p>

<p>В последнем примере применены два интересных приема.
</p><ul>
<li>Первый <nobr><tt>{}</tt></nobr>-блок содержит placeholder, единственным назначением которого
является указание, следует пропустить тело блока или нет. Если он равен 1, то
выполняется «бесполезное» условие 1 = 1, и блок остается. Если же он равен 
<nobr><tt>DBSIMPLE_SKIP</tt></nobr>, то блок удаляется.
</li><li>Второй <nobr><tt>{}</tt></nobr>-блок тоже используется довольно интересно. Он начинается с
ключевого слова <nobr><tt>AND</tt></nobr>, поэтому мы вынуждены написать перед ним «бесполезное»
и всегда истинное выражение <nobr><tt>1 = 1</tt></nobr>, чтобы не получить синтаксическую ошибку. 
(Кстати, для <nobr><tt>OR</tt></nobr>-выражения надо было бы писать <nobr><tt>1 = 0</tt></nobr>.)
</li></ul>

<p>Отсюда мораль: не всегда бесполезные на первый взгляд условия действительно 
не имеют смысла. Иногда их очень удобно использовать совместно с условными блоками.



</p><h3><a name="cont30"></a>Оптимизация prepare+execute</h3>

<p>В скриптах, вставляющих много записей в таблицу, запросы обновления
обычно выполняются в цикле. Они имеют одну и ту же структуру, различаясь
лишь значениями параметров (placeholder-ов). Чтобы СУБД не приходилось
каждый раз разбирать синтаксис запроса (транслировать во внутреннее
представления), применяется идеология prepare+execute. С использованием
гипотетического синтаксиса это выглядит так:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list36" href="http://dklab.ru/lib/DbSimple/manual.html#list36" title="Ссылка на текущий листинг.">Листинг 36</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px"><font color="green">// Подготавливаем "скелет" запроса и транслируем его.</font>
$sth = prepare('INSERT INTO tbl(field) VALUES(?)');
<font color="green">// В цикле выполняем уже оттранслированный запрос.</font>
foreach ($array as $item) {
  <font color="green">// Подставляем различные значения параметров.</font>
  $sth-&gt;execute($item);
}</pre></font></td>
  </tr>
</tbody></table></p>

<p>Практически все библиотеки абстракции от СУБД (в том числе ADODB и 
PEAR DB) поддерживают независимые операции <nobr><tt>prepare()</tt></nobr> и <nobr><tt>execute()</tt></nobr>,
работающие примерно так же, как описано выше. Однократное выполнение
prepare с последующим многократным execute позволяет 
существенно улучшить производительность, однако дается это за счет
традиционного усложнения синтаксиса запросов.

</p><p>Рад сообщить, что в DbSimple данная дилемма решена беспроигрышно:
библиотека имеет только одну операцию выполнения запроса <nobr><tt>query()</tt></nobr>,
однако, несмотря на это, поддерживает многократный execute без prepare. В 
итоге мы получаем прирост производительности без изменения интерфейса
— хороший пример правильного выбора слоя абстракции для реализации этой 
возможности.

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Вынесение слоя абстракции prepare+execute за рамки DbSimple (как это 
делают все остальные библиотеки) не представляется имеющим какой-либо 
смысл, т.к. это все легко можно автоматизировать. Что DbSimple и делает.
</i></p></td>
</tr>
</tbody></table></p>

<p>Итак, если выполняется серия запросов с одинаковой структурой, но разными
значениями placeholder-ов, DbSimple <i>автоматически</i> делает одну операцию
prepare и много операций execute. Естественно, это работает только для СУБД, 
умеющих работать по схеме prepare+execute (например, в InterBase/FireBird). 
Здесь особенно полезна поддержка "родных" placeholder-ов базы, сильно ускоряющая 
работу: в большинстве случаев накладных расходов вообще нет.

</p><p>Пример теперь можно переписать так:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list37" href="http://dklab.ru/lib/DbSimple/manual.html#list37" title="Ссылка на текущий листинг.">Листинг 37</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">foreach ($array as $item) {
  <font color="green">// Подставляем различные значения параметров.</font>
  $DB-&gt;query('INSERT INTO tbl(field) VALUES(?)', $item);
}</pre></font></td>
  </tr>
</tbody></table></p>

Операция prepare будет выполнена только при первом получении
запроса "<nobr><tt>INSERT INTO tbl(field) VALUES(?)</tt></nobr>", а во всех остальных
случаях запустится только execute, экономя время.



<h3><a name="cont31"></a>Логирование запросов</h3>

<p>При отладке и оптимизации скриптов неоценимую помощь может оказать
журнал всех SQL-запросов, выполняемых в ходе работы. Для вывода этого
журнала удобнее всего использовать библиотеку 
<a href="http://dklab.ru/lib/Debug_HackerConsole">Debug_HackerConsole</a>, чтобы
не засорять лог-файлы лишней информацией, которую все равно мало кто 
будет читать.

</p><p>DbSimple позволяет назначить функцию, которая будет вызываться
при выполнении каждого запроса:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list38" href="http://dklab.ru/lib/DbSimple/manual.html#list38" title="Ссылка на текущий листинг.">Листинг 38</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$DB-&gt;setLogger('myLogger');
function myLogger($db, $sql)
{
  <font color="green">// Находим контекст вызова этого запроса.</font>
  $caller = $db-&gt;findLibraryCaller();
  $tip = "at ".@$caller['file'].' line '.@$caller['line'];
  <font color="green">// Печатаем запрос (конечно, Debug_HackerConsole лучше).</font>
  echo "&lt;xmp title=\"$tip\"&gt;"; 
  print_r($sql); 
  echo "&lt;/xmp&gt;";
}</pre></font></td>
  </tr>
</tbody></table></p>

<p>Этой функции передается полный текст запроса, в котором placeholder-ы уже 
заменены на свои значения (это касается также и "родных" placeholder-ов базы).
Контекст (файл и номер строки), в котором был запущен данный запрос, вы можете
получить при помощи метода <nobr><tt>findLibraryCaller()</tt></nobr>.

</p><p>Функция логирования запускается не только для обычных SQL-запросов,
но также и для вывода статистики. Например, для команд:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list39" href="http://dklab.ru/lib/DbSimple/manual.html#list39" title="Ссылка на текущий листинг.">Листинг 39</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$rows = $DB-&gt;select('SELECT * FROM U_GET_PARAM_LIST');</pre></font></td>
  </tr>
</tbody></table></p>

<p>будет выполнена серия из двух вызовов обработчика:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list40" href="http://dklab.ru/lib/DbSimple/manual.html#list40" title="Ссылка на текущий листинг.">Листинг 40</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">SELECT * FROM U_GET_PARAM_LIST;
  --- 13 ms = 4+3+6; returned 30 row(s);</pre></font></td>
  </tr>
</tbody></table></p>

<p>Здесь "<nobr><tt>SELECT ...</tt></nobr>" — это первый вызов функции логирования, а 
"<nobr><tt>--- 13 ms ..</tt></nobr>" — второй вызов. Вы можете заметить, что, 
фактически, во втором случае никакой запрос не выполнялся: т.к.
текст представляет собой "голый" комментарий, выполнять просто 
нечего. Такого рода "запросы" библиотека генерирует при соединении
с базой данных, при запуске новой транзакции, работе с 
BLOB-объектами и т.&nbsp;д. Они все носят чисто информационный характер 
и в базу не идут.

</p><p>Итак, информационные записи содержат:
</p><ul>
<li>Время выполнения запроса.
</li><li>В случае возникновения ошибки СУБД — текст этой ошибки с кратким 
указанием контекста вызова.
</li><li>Для SELECT-запросов: число строк результата. Если строка всего
одна, и данных не слишком много, она будет включена прямо в 
информационную запись.
</li><li>Для UPDATE- и INSERT-запросов: признак успешности выполнения.
</li></ul>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
Если функция логирования не установлена, библиотека работает гораздо
быстрее: ведь ей нет необходимости "вручную" разворачивать "родные" 
placeholder-ы, собирать статистическую информацию, а также определять
контекст вызова запроса. Таким образом, на хостинге, где отладка
не нужна, просто не назначайте функцию-логгер.
</div></td>
</tr>
</tbody></table></p>



<h3><a name="cont32"></a>Транзакции</h3>

<p>Транзакции поддерживаются методами <nobr><tt>$DB-&gt;transaction()</tt></nobr>,
<nobr><tt>commit()</tt></nobr> и <nobr><tt>rollback()</tt></nobr>. У каждого соединения в любой момент времени
может существовать только одна текущая транзакция.



</p><h3><a name="cont33"></a>Запросы с атрибутами</h3>

<p>Каждый запрос может быть снабжен одним или несколькими атрибутами, являющимися 
некоторыми указаниями для DbSimple. Они оформляются в виде SQL-комментариев, идущих 
перед телом запроса, и имеют формат:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list41" href="http://dklab.ru/lib/DbSimple/manual.html#list41" title="Ссылка на текущий листинг.">Листинг 41</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">— AttributeName: AttributeValue</pre></font></td>
  </tr>
</tbody></table></p>


<h4><a name="cont34"></a>Атрибут BLOB_OBJ: объектные BLOB-поля</h4>

<p>Если BLOB-ы очень большие, можно работать с ними как с объектами,
выполняя read и write "кусками".

</p><p>Для того, чтобы получить blob-поля в виде объектов, а не в виде строки,
используйте синтаксис:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list42" href="http://dklab.ru/lib/DbSimple/manual.html#list42" title="Ссылка на текущий листинг.">Листинг 42</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$row = $DB-&gt;selectRow(<nobr>'
    —</nobr> BLOB_OBJ: true
    SELECT * FROM table WHERE id=123
');</pre></font></td>
  </tr>
</tbody></table></p>

<p>В результате в <nobr><tt>$row['blob_field']</tt></nobr> окажется не строка, равная содержимому
blob-а, а объект <nobr><tt>DbSimple_*_Blob</tt></nobr>, у которого есть метод <nobr><tt>read()</tt></nobr>.


</p><h4><a name="cont35"></a>Атрибут CACHE: кэширование запросов</h4>

<p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/exclam.gif" alt="Лирическое отступление" width="32" height="32">&nbsp;</nobr></td>
<td><div style="margin-top:0; font-style:italic">
<b>Внимание:</b> данная функциональность находится в разработке и в настоящее время 
может работать нестабильно. Используйте ее с осторожностью.
</div></td>
</tr>
</tbody></table></p>

<p>Кэширование осуществляется в предположении, что один и тот же запрос, выполняемый
через небольшой промежуток времени, вернет одинаковый результат. Для управления этим
промежутком используется синтаксис:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list43" href="http://dklab.ru/lib/DbSimple/manual.html#list43" title="Ссылка на текущий листинг.">Листинг 43</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$row = $DB-&gt;select(<nobr>'
    —</nobr> CACHE: 10h 20m 30s
    SELECT * FROM table WHERE id=123
');</pre></font></td>
  </tr>
</tbody></table></p>

<p>Здесь "10h 20m 30s" - промежуток времени, в течение которого запрос будет браться из кэша. 
(Если указано только число, то оно трактуется как промежуток времени в секундах.)


</p><h5><a name="cont36"></a>Зависимость от источников данных</h5>

<p>Вы можете также использовать дополнительные условия для управления инвалидацией кэша. Например,
если одна из таблиц, участвующих в запросе, изменилась, следует считать кэш недействительным.
Вы можете сообщить об этом DbSimple при помощи следующей конструкции:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list44" href="http://dklab.ru/lib/DbSimple/manual.html#list44" title="Ссылка на текущий листинг.">Листинг 44</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px">$row = $DB-&gt;select(<nobr>'
    —</nobr> CACHE: 10h 20m 30s, forum.modified, topic.modified
    SELECT * 
    FROM forum JOIN topic ON topic.forum_id=forum.id 
    WHERE id=123
');</pre></font></td>
  </tr>
</tbody></table></p>

<p>Здесь предполагается, что в таблице <nobr><tt>forum</tt></nobr> имеется столбец с именем <nobr><tt>modified</tt></nobr>, хранящий
дату последнего изменения записи (аналогично и с таблицей <nobr><tt>topic</tt></nobr>). Как только в указанных таблицах
появляется новая запись, библиотека это обнаруживает, делая запрос <nobr><tt>SELECT MAX(forum.modified) FROM forum</tt></nobr>, 
и очищает кэш. 

</p><p><table border="0">
<tbody><tr valign="top">
<td><nobr><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/teapot.gif" alt="Чайник" width="40" height="40">&nbsp;</nobr></td>
<td><p style="margin-top:0"><i>
Конечно, чтобы инвалидация работала правильно, вы должны перечислить все таблицы, от которых 
зависит запрос. Кроме того, убедитесь, что с полем <nobr><tt>modified</tt></nobr> в БД связан индекс, иначе запрос
на получение самой новой записи может работать очень долго.
</i></p></td>
</tr>
</tbody></table></p>

<h5><a name="cont37"></a>Работа с кэш-хранилищем</h5>

<p>При работе с кэшем используются две общие операции: запись данных в кэш и чтение данных из кэша. 
Сама библиотека DbSimple не содержит методов, которые их реализуют. Это и понятно: в каждом конкретном 
приложении используется своя собственная система кэширования. 

</p><p>Пожалуй, самым оптимальным вариантом можно считать применение 
<a href="http://www.danga.com/memcached/">memcached</a>, т.к. он поддерживает автоматическую очистку 
старых записей кэша на основе частоты их использования. Однако, если memcached недоступен, то подойдет и 
любая другая реализация (например, на файлах).

</p><p>Для подключения кэш-функции к библиотеке используется следующий синтаксис:


</p><p><table cellspacing="1" cellpadding="6" border="0" width="98%">
  <tbody><tr bgcolor="#DDDDDD" style="border-top: 1px dashed black"> 
  	
    
    <td width="100%" bgcolor="#E5E5E5" style="border-top: 1px solid #F0F0F0; border-right: 1px solid #F0F0F0; border-left: 1px solid #F0F0F0">
    	<div style="float:right">
<font size="-1"><a href="http://dklab.ru/lib/DbSimple/manual.html#" onclick="
  if (document.body.createTextRange) {
var BodyRange = document.body.createTextRange(); 
BodyRange.moveToElementText(this.parentNode.parentNode.parentNode.nextSibling.firstChild); 
BodyRange.execCommand(&#39;Copy&#39;);  
alert(&#39;Код скопирован в буфер обмена Windows.&#39;);
return false;
  } else {
alert(&#39;Не поддерживается операции с буфером обмена.&#39;);
  }
  return false;
"><span class="genmed">скопировать код в буфер обмена</span></a>
</font>
</div>
<font size="-1">
    	<b>
    		<a name="#list45" href="http://dklab.ru/lib/DbSimple/manual.html#list45" title="Ссылка на текущий листинг.">Листинг 45</a>
    	</b>
</font></td>
  </tr>
  <tr bgcolor="#F0F0F0">
    
    <td><font size="+0"><pre style="margin: 0px"><font color="green">// Connect to database.</font>
$DB = DbSimple_Generic::connect($dsn);
<font color="green">// Set caching function.</font>
$DB-&gt;setCacher('myCacher');
<font color="green">// Define caching function.</font>
function myCacher($key, $value)
{
    <font color="green">// Если $value !== null, то следует записать его в кэш с ключом $key.</font>
    <font color="green">// Если $value === null, то следует вернуть значение кэша с ключом $key.</font>
}</pre></font></td>
  </tr>
</tbody></table></p>



<h2><a name="cont38"></a><span style="font-size: 18pt">Резюме</span></h2>

<p>Библиотека DbSimple является удобным инструментом для тех, кто пишет скрипты с 
использованием большого разнообразия сложных SQL-запросов. Ее основная черта — простота
и лаконичность повседневного применения. А вот и другие два плюса библиотеки: расширенная 
поддержка placeholder-ов и условные макроблоки.</p></td>
<td style="width:2px; padding:0"><br></td>
<td style="width:30em; padding-left:2em">
<div style="margin-bottom: 1.4em">

<a href="http://dklab.ru/redir?http://forum.dklab.ru/comments/lib/DbsimpleV2XLaconicWorkWithVariousSubd.html"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/forum_favicon.ico" alt="" width="16" style="margin-right:4px" height="16" border="0">Обсудить статью в форуме</a><br>
<a href="http://dklab.ru/lib/DbSimple/demo.zip"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/zip.gif" alt="" style="margin-left:1px; margin-right:4px" border="0" width="15" height="16">Скачать библиотеку и примеры</a><br>
<a href="http://dklab.ru/lib/DbSimple/demo/test/"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/li-dir.gif" alt="" style="padding-left:-1px; padding-right:4px; margin-right:4px" border="0" width="11" height="10">Просмотреть примеры online</a><br>

    	<a href="http://github.com/DmitryKoterov/dbsimple/tree/master"><img src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/git_ico.gif" alt="" style="position:relative; top:3px; margin-right:4px" border="0" width="15" height="16">Просмотреть GIT-репозиторий</a>
    
</div>

<!--
<div>	
<div style="margin-bottom:6px; font-weight:bold">
Пользуетесь? Нравится?.. Пожертвуйте!
</div>

<div style="background: white; padding:3px;">
<form action="wmk:payto" style="padding:0; margin:1px" method="get">
<table cellpadding="0" cellspacing="0" border="0">
<tr>
<td width="40" align="center"><img src=/img/wmkeeper_32x32.png alt="" width=32 height=32></td>
<td style="padding-left:0.5em">
<input type=submit value="Пожертвовать"><input type=text name="Amount" size="4" value="15"> WMZ<br/>
<input type=hidden name="Purse" value="Z897781049270">WebMoney на кошелек <b>Z897781049270</b>
<input type=hidden name="Desc" value="Пожертвование для dklab.ru"><input type=hidden name="BringToFront" value="Y"></td>
</tr>
</table>
</form>
</div>

<div style="background: white; padding:3px; margin-top:6px">
<form action="https://money.yandex.ru/charity.xml" style="padding:0; margin:1px" method="post">
<table cellpadding="0" cellspacing="0" border="0">
<tr>
<td width="40" align="left"><img src=/img/ya_money.gif alt="" width=37 height=25></td>
<td style="padding-left:0.5em">
<input type=hidden name="to" value="4100156676080"><input type=hidden name="CompanyName" value="dkLab"><input type=hidden name="CompanyLink" value="http://www.dklab.ru"><input type=submit value="Пожертвовать"><input type=text name="CompanySum" size="4" id="CompanySum" value="499"> руб.<br/>
Яндекс.Деньгами на счёт <b>4100156676080</b>
</td>
</tr>
</table>
</form>
</div>

<p><i>Пожертвование пойдет в качестве "спасибо" прямиком 
на поддержание мотивации автора. А то он даже не знает, какое
количество людей пользуется той или иной библиотекой
или утилитой...</i></p>
</div>

-->

</td>
</tr>
</tbody></table>
<br><br>
<script type="text/javascript"><!--
google_ad_client = "pub-7882344363883855";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "008000";
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script><br>
    	</p><div style="width:760px; margin-top:10px"> <a href="http://www.shop-script.ru/" target="_blank">создать интернет-магазин на украине</a> </div>
    <br>


</div>
</td>
</tr></tbody></table>



<hr height="1" style="clear:both">

<div style="float:left; padding-bottom:3px">
    <div style="float:left">
        Дмитрий Котеров, Лаборатория dk. ©1999-2014    </div>
</div>

<div style="float:right; text-align:right">
    <script language="JavaScript">
    <!--
    function getCookie(name) {
      var p = name + "=";
      var si = document.cookie.indexOf(p);
      if(si == -1) return null;
      var ei = document.cookie.indexOf(";", si + p.length);
      if(ei == -1) ei = document.cookie.length;
      return unescape(document.cookie.substring(si + p.length, ei));
    }
    //-->
    </script>
    <script language="JavaScript">
    <!--
      var s = getCookie("page_time");
      if (s) {
        //document.write("Generation time: "+s+" s<br>");
      }
    //-->
    </script>
    GZip <script language="JavaScript">
      <!--
      var s = getCookie("page_size");
      if (s) {
        var p = s.split(/,\s*/);
        document.write("enabled: <span title='стало'>"+p[1]+"</span>/<span title='было'>"+p[0]+"</span> <span title='откусили'>("+(100-Math.round(p[1]/p[0]*100))+"%)</span>");
      } else {
        document.write("disabled");
      }
      //-->
      </script>enabled: <span title="стало">33900</span>/<span title="было">123567</span> <span title="откусили">(73%)</span>
</div>

<center>
    <a id="1" href="http://dklab.ru/lib/DbSimple/manual.html#">Добавить на Del.icio.us</a>
<script>document.getElementById('1').href = 'http://del.icio.us/post?url=http://dklab.ru/lib/DbSimple/manual.html&title='+encodeURIComponent(document.title.replace(/.*\|\s*/, ''))</script>&nbsp;
    <a id="2" href="http://dklab.ru/lib/DbSimple/manual.html#">Добавить на Digg.com</a>
<script>document.getElementById('2').href = 'http://digg.com/submit?phase=2&url=http://dklab.ru/lib/DbSimple/manual.html&title='+encodeURIComponent(document.title.replace(/.*\|\s*/, ''))</script>&nbsp;
    <a id="3" href="http://reddit.com/submit?url=http://dklab.ru/lib/DbSimple/manual.html&title=%D0%9F%D0%BE%D0%B4%D1%80%D0%BE%D0%B1%D0%BD%D0%BE%D1%81%D1%82%D0%B8">Добавить на reddit.com</a>
<script>document.getElementById('3').href = 'http://reddit.com/submit?url=http://dklab.ru/lib/DbSimple/manual.html&title='+encodeURIComponent(document.title.replace(/.*\|\s*/, ''))</script>
</center>

<!--
<script type="text/javascript" language="JavaScript" src="/js/Autohyphen.js"></script>
<script>
new Autohyphen().hyphenizeTree(document.getElementById('adv'+'test'.substring(0,0)+'Block'));
</script>
-->
<!-- <script type="text/javascript" language="JavaScript" src="/js/LinkClassifier.js"></script> -->

<script src="./dkLab   Конструктор   DbSimple  лаконичная работа с различными СУБД   Подробности_files/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1168534-1";
if (window.urchinTracker) urchinTracker();
</script>



<style>.tb_button {padding:1px;cursor:pointer;border-right: 1px solid #8b8b8b;border-left: 1px solid #FFF;border-bottom: 1px solid #fff;}.tb_button.hover {borer:2px outset #def; background-color: #f8f8f8 !important;}.ws_toolbar {z-index:100000} .ws_toolbar .ws_tb_btn {cursor:pointer;border:1px solid #555;padding:3px}   .tb_highlight{background-color:yellow} .tb_hide {visibility:hidden} .ws_toolbar img {padding:2px;margin:0px}</style><a id="ext_btt" href="http://dklab.ru/lib/DbSimple/manual.html#"><img src="chrome-extension://alpoeaffjpfnidlkiidponkainlnfhnl/images/icon.png"></a></body></html>